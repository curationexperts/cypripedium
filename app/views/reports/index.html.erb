<% provide :page_header do %>
  <h1><span class="fa fa-list-alt" aria-hidden="true"></span>Publication Statistics</h1>
<% end %>

<% headers = @report[0] %>
<% available_years = (2018..Date.current.year).map{|y| [y.to_s, y.to_s + '-01-01T00:00:00Z']}.reverse %>
<div id=report>
  <div class="button_holder">
    <div id="reporting_options">
      <%= form_with method: :get, local: true, skip_enforcing_utf8: true do |report_options| %>
        <%= report_options.label :start_date, 'Start:' %>
        <%= report_options.select :start_date, available_years, selected: @start_date %>
        <%= report_options.label :period, 'Interval:' %>
        <%= report_options.select :period, ['yearly', 'quarterly', 'monthly'], selected: @period %>
        <%= report_options.submit 'Refresh', name: '', class: 'btn btn-info' %>
      <% end %>
    </div>
    <%= link_to('Download', reports_path(format: nil, params: { format: :csv }), class: 'btn btn-primary', id: 'reports-download' )%>
  </div>
  <table class="table  table-striped table-bordered">
    <thead class="thead-dark">
      <tr>
        <% headers.each do |key, label| %>
          <th class="<%= "report-#{key.parameterize}" -%>"><%= label -%></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @report[1..-1].each do |row| %>
        <tr>
          <% headers.keys.each do |key| %>
            <td class="<%= "report-#{key.parameterize}" -%>"><%= author_formatter(row, key, @start_date) -%></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
